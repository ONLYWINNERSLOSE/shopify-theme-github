{% liquid
  assign widths = '300, 450, 600, 750, 900, 1050, 1200, 1350, 1500, 1650, 1800, 1950, 2100, 2400, 2700, 3000, 3300, 3600'
  assign desktop_size = '(min-width: 750px) calc((100vw - 2px) / 3)'
  assign mobile_size = 'calc((100vw - 2px) / 3)'
  assign sizes = mobile_size | append: ', ' | append: desktop_size

  assign aspect_ratio = null

  case block.settings.image_ratio
    when 'square'
      assign aspect_ratio = '1 / 1'
    when 'landscape'
      assign aspect_ratio = '4 / 3'
    when 'portrait'
      assign aspect_ratio = '3 / 4'
    when 'widescreen'
      assign aspect_ratio = '16 / 9'
  endcase

  if block.settings.image_ratio == 'adapt'
    assign aspect_ratio = null
  endif

  if aspect_ratio
    assign container_class = 'three-image-row three-image-row--has-ratio'
  else
    assign container_class = 'three-image-row'
  endif
%}

<div class="{{ container_class }}"{% if aspect_ratio %} style="--three-image-row-aspect: {{ aspect_ratio }};"{% endif %} {{ block.shopify_attributes }}>
  {% for i in (1..3) %}
    {% assign image_setting = 'image_' | append: i %}
    {% assign link_setting = 'link_' | append: i %}
    {% assign alt_setting = 'image_' | append: i | append: '_alt' %}
    {% assign image = block.settings[image_setting] %}
    {% assign link = block.settings[link_setting] %}
    {% assign alt_text = block.settings[alt_setting] %}

    {% liquid
      if alt_text == blank and image != blank and image.alt != blank
        assign alt_text = image.alt
      endif

      if alt_text == blank
        assign alt_text = 'Image ' | append: i
      endif
    %}

    <div class="three-image-row__item">
      {% if image %}
        {% capture image_markup %}
          {{
            image
            | image_url: width: 3840
            | image_tag:
              widths: widths,
              sizes: sizes,
              loading: 'lazy',
              class: 'three-image-row__image',
              alt: alt_text
          }}
        {% endcapture %}

        {% if link %}
          <a href="{{ link }}" class="three-image-row__link">
            {{ image_markup | strip }}
          </a>
        {% else %}
          {{ image_markup | strip }}
        {% endif %}
      {% else %}
        <div class="three-image-row__placeholder">
          {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {% endif %}
    </div>
  {% endfor %}
</div>

{% stylesheet %}
  .three-image-row {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 1px;
  }

  .three-image-row__item {
    position: relative;
    overflow: hidden;
    background: rgb(var(--color-background));
  }

  .three-image-row--has-ratio .three-image-row__item {
    aspect-ratio: var(--three-image-row-aspect);
  }

  .three-image-row__link,
  .three-image-row__link:visited {
    display: block;
    color: inherit;
  }

  .three-image-row__image {
    width: 100%;
    display: block;
    object-fit: cover;
  }

  .three-image-row--has-ratio .three-image-row__image {
    height: 100%;
  }

  .three-image-row__placeholder {
    position: relative;
    padding-top: 66.66%;
    background: rgba(var(--color-foreground), 0.04);
  }

  .three-image-row--has-ratio .three-image-row__placeholder {
    padding-top: 0;
    height: 100%;
  }

  .three-image-row__placeholder .placeholder-svg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Three image row",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "default": "square",
      "options": [
        {
          "value": "adapt",
          "label": "Match image"
        },
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "landscape",
          "label": "Landscape"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "widescreen",
          "label": "Widescreen"
        }
      ]
    },
    {
      "type": "header",
      "content": "First image"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "image_1_alt",
      "label": "Alt text",
      "info": "Alternative text for accessibility."
    },
    {
      "type": "url",
      "id": "link_1",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Second image"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "image_2_alt",
      "label": "Alt text",
      "info": "Alternative text for accessibility."
    },
    {
      "type": "url",
      "id": "link_2",
      "label": "Link"
    },
    {
      "type": "header",
      "content": "Third image"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "image_3_alt",
      "label": "Alt text",
      "info": "Alternative text for accessibility."
    },
    {
      "type": "url",
      "id": "link_3",
      "label": "Link"
    }
  ],
  "presets": [
    {
      "name": "Three image row"
    }
  ]
}
{% endschema %}
